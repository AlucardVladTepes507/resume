<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Generador de Currículums Desde Cero</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.26.0/babel.min.js"></script>
  <script src="https://unpkg.com/react-to-print@2.14.7/dist/index.umd.js"></script>
</head>
<body>
  <div id="root">Cargando generador...</div>

  <script type="text/babel">
    // --- Initial Data Structure ---
    const initialResumeState = {
      personal: { name: '', email: '', phone: '', address: '', linkedin: '', portfolio: '', photo: null },
      summary: '',
      experience: [],
      education: [],
      skills: [],
      languages: [],
    };

    // --- Reusable UI Components ---
    const FormSection = ({ title, children }) => (
      <div className="p-6 bg-gray-50 rounded-lg shadow-inner space-y-4">
        <h2 className="text-xl font-semibold text-gray-800 border-b pb-2">{title}</h2>
        {children}
      </div>
    );

    const Input = ({ label, name, value, onChange, ...props }) => (
      <div>
        <label htmlFor={name} className="block text-sm font-medium text-gray-700">{label}</label>
        <input id={name} name={name} value={value} onChange={onChange} {...props} className="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500" />
      </div>
    );
    
    const Textarea = ({ label, name, value, onChange, ...props }) => (
      <div>
        <label htmlFor={name} className="block text-sm font-medium text-gray-700">{label}</label>
        <textarea id={name} name={name} value={value} onChange={onChange} {...props} className="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500"></textarea>
      </div>
    );

    // --- Main App Component ---
    const App = () => {
      const { useState, useRef } = React;
      // CORRECTED: Safely access useReactToPrint by providing a fallback empty object.
      const { useReactToPrint } = window.ReactToPrint || {};

      const [resume, setResume] = useState(initialResumeState);
      const [layout, setLayout] = useState('single'); // 'single' or 'two'
      const resumePreviewRef = useRef();

      const handleChange = (e) => {
        const { name, value, dataset } = e.target;
        const { section, index } = dataset;

        if (section === 'personal' || section === 'summary') {
          setResume(prev => ({ ...prev, [section]: section === 'personal' ? { ...prev.personal, [name]: value } : value }));
        } else {
          setResume(prev => ({
            ...prev,
            [section]: prev[section].map((item, i) => i === parseInt(index) ? { ...item, [name]: value } : item)
          }));
        }
      };
      
      const handleSkillsChange = (e) => {
          const skillsArray = e.target.value.split(',').map(skill => skill.trim());
          setResume(prev => ({ ...prev, skills: skillsArray }));
      };
      
      const handleLanguagesChange = (e) => {
          const languagesArray = e.target.value.split(',').map(lang => lang.trim());
          setResume(prev => ({ ...prev, languages: languagesArray }));
      };

      const addItem = (section) => {
        const newItem = {
          experience: { id: Date.now(), title: '', company: '', location: '', startDate: '', endDate: '', description: '' },
          education: { id: Date.now(), degree: '', institution: '', location: '', startDate: '', endDate: '' },
        };
        setResume(prev => ({ ...prev, [section]: [...prev[section], newItem[section]] }));
      };

      const removeItem = (section, index) => {
        setResume(prev => ({ ...prev, [section]: prev[section].filter((_, i) => i !== index) }));
      };
      
      const handlePhotoUpload = (e) => {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onloadend = () => setResume(prev => ({ ...prev, personal: { ...prev.personal, photo: reader.result } }));
          reader.readAsDataURL(file);
        }
      };

      // CORRECTED: Conditionally define handlePrint only if useReactToPrint is available.
      const handlePrint = useReactToPrint ? useReactToPrint({
        content: () => resumePreviewRef.current,
        documentTitle: `CV-${resume.personal.name || 'Candidato'}`,
      }) : () => {
          alert("La función de impresión no está lista. Por favor, espere un momento o refresque la página.");
      };
      
      const resetForm = () => {
        if (confirm('¿Estás seguro de que quieres borrar toda la información?')) {
          setResume(initialResumeState);
        }
      };

      return (
        <div className="min-h-screen bg-gray-200 p-4 sm:p-8 font-['Inter',_sans-serif]">
          <div className="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-2 gap-8">
            {/* --- FORM COLUMN --- */}
            <div className="bg-white p-6 rounded-xl shadow-lg space-y-6">
              <div className="flex justify-between items-center">
                <h1 className="text-3xl font-bold text-gray-800">Generador de CV</h1>
                <button onClick={resetForm} className="px-4 py-2 text-sm font-medium text-red-700 bg-red-100 rounded-lg hover:bg-red-200 focus:outline-none">Reiniciar</button>
              </div>

              <FormSection title="1. Información Personal">
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <Input label="Nombre Completo" name="name" value={resume.personal.name} onChange={handleChange} data-section="personal" placeholder="Ej: Ana García"/>
                  <Input label="Email" name="email" type="email" value={resume.personal.email} onChange={handleChange} data-section="personal" placeholder="ana.garcia@email.com"/>
                  <Input label="Teléfono" name="phone" value={resume.personal.phone} onChange={handleChange} data-section="personal" />
                  <Input label="Dirección" name="address" value={resume.personal.address} onChange={handleChange} data-section="personal" placeholder="Ciudad, País"/>
                  <Input label="LinkedIn (URL)" name="linkedin" value={resume.personal.linkedin} onChange={handleChange} data-section="personal" />
                  <Input label="Portfolio (URL)" name="portfolio" value={resume.personal.portfolio} onChange={handleChange} data-section="personal" />
                  <div>
                    <label className="block text-sm font-medium text-gray-700">Foto de Perfil</label>
                    <input type="file" accept="image/*" onChange={handlePhotoUpload} className="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"/>
                  </div>
                </div>
              </FormSection>

              <FormSection title="2. Resumen Profesional">
                <Textarea label="Tu resumen" name="summary" value={resume.summary} onChange={handleChange} data-section="summary" rows="4" placeholder="Describe brevemente tu perfil y objetivos..."/>
              </FormSection>

              <FormSection title="3. Experiencia Laboral">
                {resume.experience.map((exp, index) => (
                  <div key={exp.id} className="p-4 border rounded-md space-y-3 relative bg-white">
                    <button onClick={() => removeItem('experience', index)} className="absolute top-2 right-2 text-red-500 hover:text-red-700 text-xl font-bold">&times;</button>
                    <Input label="Puesto" name="title" value={exp.title} onChange={handleChange} data-section="experience" data-index={index}/>
                    <Input label="Empresa y Ubicación" name="company" value={exp.company} onChange={handleChange} data-section="experience" data-index={index} placeholder="Nombre Empresa | Ciudad"/>
                    <div className="grid grid-cols-2 gap-4">
                      <Input label="Fecha de Inicio" name="startDate" value={exp.startDate} onChange={handleChange} data-section="experience" data-index={index} placeholder="Ej: Ene 2020"/>
                      <Input label="Fecha de Fin" name="endDate" value={exp.endDate} onChange={handleChange} data-section="experience" data-index={index} placeholder="Ej: Dic 2022 o Actual"/>
                    </div>
                    <Textarea label="Descripción y Logros" name="description" value={exp.description} onChange={handleChange} data-section="experience" data-index={index} rows="3" placeholder="- Logro 1..."/>
                  </div>
                ))}
                <button onClick={() => addItem('experience')} className="w-full py-2 px-4 text-sm font-medium text-blue-700 bg-blue-100 rounded-lg hover:bg-blue-200">Añadir Experiencia</button>
              </FormSection>

              <FormSection title="4. Educación">
                 {resume.education.map((edu, index) => (
                  <div key={edu.id} className="p-4 border rounded-md space-y-3 relative bg-white">
                    <button onClick={() => removeItem('education', index)} className="absolute top-2 right-2 text-red-500 hover:text-red-700 text-xl font-bold">&times;</button>
                    <Input label="Título Obtenido" name="degree" value={edu.degree} onChange={handleChange} data-section="education" data-index={index}/>
                    <Input label="Institución y Ubicación" name="institution" value={edu.institution} onChange={handleChange} data-section="education" data-index={index}/>
                    <div className="grid grid-cols-2 gap-4">
                      <Input label="Fecha de Inicio" name="startDate" value={edu.startDate} onChange={handleChange} data-section="education" data-index={index}/>
                      <Input label="Fecha de Fin" name="endDate" value={edu.endDate} onChange={handleChange} data-section="education" data-index={index}/>
                    </div>
                  </div>
                ))}
                <button onClick={() => addItem('education')} className="w-full py-2 px-4 text-sm font-medium text-blue-700 bg-blue-100 rounded-lg hover:bg-blue-200">Añadir Educación</button>
              </FormSection>
              
               <FormSection title="5. Habilidades e Idiomas">
                <Textarea label="Habilidades (separadas por coma)" name="skills" value={resume.skills.join(', ')} onChange={handleSkillsChange} placeholder="HTML, CSS, JavaScript, Liderazgo..."/>
                <Textarea label="Idiomas (separados por coma)" name="languages" value={resume.languages.join(', ')} onChange={handleLanguagesChange} placeholder="Español (Nativo), Inglés (Avanzado)..."/>
              </FormSection>
            </div>

            {/* --- PREVIEW COLUMN --- */}
            <div className="sticky top-8 self-start">
              <div className="bg-white p-6 rounded-xl shadow-lg space-y-4">
                <h2 className="text-2xl font-bold text-gray-800">Vista Previa y Descarga</h2>
                <div className="flex items-center space-x-4">
                  <span className="text-sm font-medium text-gray-700">Diseño:</span>
                  <button onClick={() => setLayout('single')} className={`px-4 py-2 text-sm rounded-lg ${layout === 'single' ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-700'}`}>1 Columna</button>
                  <button onClick={() => setLayout('two')} className={`px-4 py-2 text-sm rounded-lg ${layout === 'two' ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-700'}`}>2 Columnas</button>
                </div>
                <div className="border border-dashed border-gray-300 p-4 rounded-lg bg-gray-50 min-h-[500px] max-h-[70vh] overflow-auto">
                    <div ref={resumePreviewRef} className="p-8 bg-white text-gray-800">
                        {/* A simple router to show the selected layout */}
                        {layout === 'single' ? <SingleColumnPreview resume={resume} /> : <TwoColumnPreview resume={resume} />}
                    </div>
                </div>
                {/* CORRECTED: The button is disabled if useReactToPrint is not available. */}
                <button onClick={handlePrint} disabled={!useReactToPrint} className="w-full bg-green-500 text-white font-bold py-3 px-4 rounded-lg hover:bg-green-600 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed">
                  {useReactToPrint ? 'Descargar como PDF' : 'Cargando PDF...'}
                </button>
              </div>
            </div>
          </div>
        </div>
      );
    };
    
    // --- Preview Layouts ---
    const SingleColumnPreview = ({ resume }) => {
        const hasContent = (arr) => arr && arr.length > 0;
        return(
        <div>
            <header className="text-center mb-6">
                {resume.personal.photo && <img src={resume.personal.photo} className="w-32 h-32 rounded-full mx-auto mb-4 object-cover" />}
                <h1 className="text-4xl font-bold">{resume.personal.name}</h1>
                <p className="text-sm text-gray-600 mt-2">{resume.personal.address} &bull; {resume.personal.email} &bull; {resume.personal.phone}</p>
                <p className="text-sm text-blue-600">{resume.personal.linkedin} {resume.personal.portfolio && `&bull; ${resume.personal.portfolio}`}</p>
            </header>
            
            {resume.summary && <section className="mb-6"><h2 className="preview-h2">Resumen</h2><p className="preview-p">{resume.summary}</p></section>}
            {hasContent(resume.experience) && <section className="mb-6"><h2 className="preview-h2">Experiencia</h2>{resume.experience.map(exp => <div key={exp.id} className="mb-4"><h3 className="font-bold">{exp.title}</h3><p className="italic text-sm">{exp.company}</p><p className="text-xs text-gray-500">{exp.startDate} - {exp.endDate}</p><p className="preview-p mt-1">{exp.description}</p></div>)}</section>}
            {hasContent(resume.education) && <section className="mb-6"><h2 className="preview-h2">Educación</h2>{resume.education.map(edu => <div key={edu.id} className="mb-4"><h3 className="font-bold">{edu.degree}</h3><p className="italic text-sm">{edu.institution}</p><p className="text-xs text-gray-500">{edu.startDate} - {edu.endDate}</p></div>)}</section>}
            {hasContent(resume.skills) && <section className="mb-6"><h2 className="preview-h2">Habilidades</h2><div className="flex flex-wrap gap-2">{resume.skills.map(s => s && <span key={s} className="pill">{s}</span>)}</div></section>}
            {hasContent(resume.languages) && <section className="mb-6"><h2 className="preview-h2">Idiomas</h2><div className="flex flex-wrap gap-2">{resume.languages.map(l => l && <span key={l} className="pill">{l}</span>)}</div></section>}
            
            <style>{previewStyles}</style>
        </div>
    )};

    const TwoColumnPreview = ({ resume }) => {
        const hasContent = (arr) => arr && arr.length > 0;
        return(
        <div className="flex gap-8">
            <div className="w-1/3">
                {resume.personal.photo && <img src={resume.personal.photo} className="w-32 h-32 rounded-full mx-auto mb-4 object-cover" />}
                <section className="mb-6">
                    <h2 className="preview-h2-sidebar">Contacto</h2>
                    <p className="preview-p-sidebar">{resume.personal.address}</p>
                    <p className="preview-p-sidebar">{resume.personal.email}</p>
                    <p className="preview-p-sidebar">{resume.personal.phone}</p>
                    <p className="preview-p-sidebar text-blue-600">{resume.personal.linkedin}</p>
                    <p className="preview-p-sidebar text-blue-600">{resume.personal.portfolio}</p>
                </section>
                {hasContent(resume.skills) && <section className="mb-6"><h2 className="preview-h2-sidebar">Habilidades</h2><div className="flex flex-wrap gap-2">{resume.skills.map(s => s && <span key={s} className="pill">{s}</span>)}</div></section>}
                {hasContent(resume.languages) && <section className="mb-6"><h2 className="preview-h2-sidebar">Idiomas</h2><div className="flex flex-wrap gap-2">{resume.languages.map(l => l && <span key={l} className="pill">{l}</span>)}</div></section>}
            </div>
            <div className="w-2/3">
                <header className="mb-6">
                    <h1 className="text-4xl font-bold">{resume.personal.name}</h1>
                </header>
                {resume.summary && <section className="mb-6"><h2 className="preview-h2">Resumen</h2><p className="preview-p">{resume.summary}</p></section>}
                {hasContent(resume.experience) && <section className="mb-6"><h2 className="preview-h2">Experiencia</h2>{resume.experience.map(exp => <div key={exp.id} className="mb-4"><h3 className="font-bold">{exp.title}</h3><p className="italic text-sm">{exp.company}</p><p className="text-xs text-gray-500">{exp.startDate} - {exp.endDate}</p><p className="preview-p mt-1">{exp.description}</p></div>)}</section>}
                {hasContent(resume.education) && <section className="mb-6"><h2 className="preview-h2">Educación</h2>{resume.education.map(edu => <div key={edu.id} className="mb-4"><h3 className="font-bold">{edu.degree}</h3><p className="italic text-sm">{edu.institution}</p><p className="text-xs text-gray-500">{edu.startDate} - {edu.endDate}</p></div>)}</section>}
            </div>
            <style>{previewStyles}</style>
        </div>
    )};

    const previewStyles = `
        .preview-h2 { font-size: 1.125rem; font-weight: 700; border-bottom: 2px solid #e5e7eb; padding-bottom: 4px; margin-bottom: 12px; }
        .preview-h2-sidebar { font-size: 1.125rem; font-weight: 700; border-bottom: 2px solid #dbeafe; padding-bottom: 4px; margin-bottom: 12px; color: #1e40af; }
        .preview-p { font-size: 0.875rem; line-height: 1.6; color: #374151; white-space: pre-wrap; }
        .preview-p-sidebar { font-size: 0.875rem; line-height: 1.6; color: #374151; word-break: break-all; }
        .pill { background-color: #e5e7eb; color: #374151; padding: 4px 12px; border-radius: 9999px; font-size: 0.75rem; }
    `;

    // --- RENDER APP ---
    // This ensures the app only renders after all external scripts (like ReactToPrint) are fully loaded.
    window.onload = function() {
      ReactDOM.render(<App />, document.getElementById('root'));
    };
  </script>
</body>
</html>

